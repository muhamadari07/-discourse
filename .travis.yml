---
services:
  - redis-server

language: rust
cache: cargo

rust:
  - nightly
  - stable

matrix:
  include:
    - rust: nightly
      env: FMT=1
      install:
        - which cargo-install-update || cargo install cargo-update
        - cargo install-update -i rustfmt-nightly
      script: cargo fmt -- --check
    - rust: stable
      env: CLIPPY=1
      install:
        - rustup component add clippy-preview
      script:
        - cargo clippy -- -D warnings -A single_match -A needless_pass_by_value
  allow_failures:
    - rust: stable
      env: CLIPPY=1

notifications:
  email:
    on_success: change
    on_failure: always
