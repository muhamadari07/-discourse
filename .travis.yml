---
services:
  - redis-server

language: rust
cache: cargo
rust: stable

matrix:
  include:
    # Tests
    - os: linux
      rust: stable
      env: UNIT=1
      script:
        - cargo test
    # Code lints
    - os: linux
      rust: nightly
      env: CLIPPY=1
      script:
        - cargo rustc --lib --features "lint" -- -Zno-trans
    # Code formatting check
    - os: linux
      rust: nightly
      env: FMT=1
      # skip the global install step
      install:
        - which cargo-install-update || cargo install cargo-update
        - cargo install-update -i rustfmt-nightly
      script: cargo fmt -- --write-mode=diff

notifications:
  email:
    on_success: change
    on_failure: always
